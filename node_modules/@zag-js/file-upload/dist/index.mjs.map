{"version":3,"sources":["../src/file-upload.anatomy.ts","../src/file-upload.connect.ts","../src/file-upload.dom.ts","../src/file-upload.utils.ts","../src/file-upload.machine.ts"],"sourcesContent":["import { createAnatomy } from \"@zag-js/anatomy\"\n\nexport const anatomy = createAnatomy(\"file-upload\").parts(\n  \"root\",\n  \"dropzone\",\n  \"item\",\n  \"itemDeleteTrigger\",\n  \"itemGroup\",\n  \"itemName\",\n  \"itemPreview\",\n  \"itemPreviewImage\",\n  \"itemSizeText\",\n  \"label\",\n  \"trigger\",\n)\n\nexport const parts = anatomy.build()\n","import { contains, dataAttr, isSelfEvent } from \"@zag-js/dom-query\"\nimport { formatFileSize } from \"@zag-js/file-utils\"\nimport { type NormalizeProps, type PropTypes } from \"@zag-js/types\"\nimport { visuallyHiddenStyle } from \"@zag-js/visually-hidden\"\nimport { parts } from \"./file-upload.anatomy\"\nimport { dom } from \"./file-upload.dom\"\nimport { type MachineApi, type Send, type State } from \"./file-upload.types\"\nimport { isEventWithFiles } from \"./file-upload.utils\"\n\nexport function connect<T extends PropTypes>(state: State, send: Send, normalize: NormalizeProps<T>): MachineApi<T> {\n  const disabled = state.context.disabled\n  const allowDrop = state.context.allowDrop\n  const translations = state.context.translations\n\n  const isDragging = state.matches(\"dragging\")\n  const isFocused = state.matches(\"focused\") && !disabled\n\n  return {\n    isDragging,\n    isFocused,\n    open() {\n      send(\"OPEN\")\n    },\n    deleteFile(file) {\n      send({ type: \"FILE.DELETE\", file })\n    },\n    files: state.context.files,\n    setFiles(files) {\n      const count = files.length\n      send({ type: \"FILES.SET\", files, count })\n    },\n    clearFiles() {\n      send({ type: \"FILES.CLEAR\" })\n    },\n    getFileSize(file) {\n      return formatFileSize(file.size, { locale: state.context.locale })\n    },\n    createFileUrl(file: File, cb: (url: string) => void) {\n      const win = dom.getWin(state.context)\n      const url = win.URL.createObjectURL(file)\n      cb(url)\n      return () => win.URL.revokeObjectURL(url)\n    },\n\n    rootProps: normalize.element({\n      ...parts.root.attrs,\n      dir: state.context.dir,\n      id: dom.getRootId(state.context),\n      \"data-disabled\": dataAttr(disabled),\n      \"data-dragging\": dataAttr(isDragging),\n    }),\n\n    dropzoneProps: normalize.element({\n      ...parts.dropzone.attrs,\n      dir: state.context.dir,\n      id: dom.getDropzoneId(state.context),\n      tabIndex: disabled ? undefined : 0,\n      \"aria-disabled\": disabled,\n      \"aria-invalid\": state.context.invalid,\n      \"data-invalid\": dataAttr(state.context.invalid),\n      \"data-disabled\": dataAttr(disabled),\n      \"data-dragging\": dataAttr(isDragging),\n      onKeyDown(event) {\n        if (!isSelfEvent(event)) return\n        if (event.key !== \"Enter\" && event.key !== \" \") return\n        send({ type: \"DROPZONE.CLICK\", src: \"keydown\" })\n      },\n      onClick(event) {\n        const isLabel = event.currentTarget.localName === \"label\"\n        // prevent opening the file dialog when clicking on the label (to avoid double opening)\n        if (isLabel) event.preventDefault()\n        send(\"DROPZONE.CLICK\")\n      },\n      onDragOver(event) {\n        if (!allowDrop) return\n        event.preventDefault()\n        event.stopPropagation()\n        try {\n          event.dataTransfer.dropEffect = \"copy\"\n        } catch {}\n\n        const hasFiles = isEventWithFiles(event)\n        if (!hasFiles) return\n\n        const count = event.dataTransfer.items.length\n        send({ type: \"DROPZONE.DRAG_OVER\", count })\n      },\n      onDragLeave(event) {\n        if (!allowDrop || disabled) return\n        if (contains(event.currentTarget, event.relatedTarget)) return\n        send({ type: \"DROPZONE.DRAG_LEAVE\" })\n      },\n      onDrop(event) {\n        if (allowDrop) {\n          event.preventDefault()\n          event.stopPropagation()\n        }\n\n        const hasFiles = isEventWithFiles(event)\n        if (disabled || !hasFiles) return\n\n        send({ type: \"DROPZONE.DROP\", files: Array.from(event.dataTransfer.files) })\n      },\n      onFocus() {\n        send(\"DROPZONE.FOCUS\")\n      },\n      onBlur() {\n        send(\"DROPZONE.BLUR\")\n      },\n    }),\n\n    triggerProps: normalize.button({\n      ...parts.trigger.attrs,\n      dir: state.context.dir,\n      id: dom.getTriggerId(state.context),\n      disabled,\n      \"data-disabled\": dataAttr(disabled),\n      type: \"button\",\n      onClick(event) {\n        if (disabled) return\n        // if trigger is wrapped within the dropzone, stop propagation to avoid double opening\n        if (contains(dom.getDropzoneEl(state.context), event.currentTarget)) {\n          event.stopPropagation()\n        }\n        send(\"OPEN\")\n      },\n    }),\n\n    hiddenInputProps: normalize.input({\n      id: dom.getHiddenInputId(state.context),\n      tabIndex: -1,\n      disabled,\n      type: \"file\",\n      name: state.context.name,\n      accept: state.context.acceptAttr,\n      multiple: state.context.multiple || state.context.maxFiles > 1,\n      onClick(event) {\n        event.stopPropagation()\n        // allow for re-selection of the same file\n        event.currentTarget.value = \"\"\n      },\n      onChange(event) {\n        if (disabled) return\n        const { files } = event.currentTarget\n        send({ type: \"FILES.SET\", files: files ? Array.from(files) : [] })\n      },\n      style: visuallyHiddenStyle,\n    }),\n\n    itemGroupProps: normalize.element({\n      ...parts.itemGroup.attrs,\n      dir: state.context.dir,\n      \"data-disabled\": dataAttr(disabled),\n    }),\n\n    getItemProps(props) {\n      const { file } = props\n      return normalize.element({\n        ...parts.item.attrs,\n        dir: state.context.dir,\n        id: dom.getItemId(state.context, file.name),\n        \"data-disabled\": dataAttr(disabled),\n      })\n    },\n\n    getItemNameProps(props) {\n      const { file } = props\n      return normalize.element({\n        ...parts.itemName.attrs,\n        dir: state.context.dir,\n        id: dom.getItemNameId(state.context, file.name),\n        \"data-disabled\": dataAttr(disabled),\n      })\n    },\n\n    getItemSizeTextProps(props) {\n      const { file } = props\n      return normalize.element({\n        ...parts.itemSizeText.attrs,\n        dir: state.context.dir,\n        id: dom.getItemSizeTextId(state.context, file.name),\n        \"data-disabled\": dataAttr(disabled),\n      })\n    },\n\n    getItemPreviewProps(props) {\n      const { file } = props\n      return normalize.element({\n        ...parts.itemPreview.attrs,\n        dir: state.context.dir,\n        id: dom.getItemPreviewId(state.context, file.name),\n        \"data-disabled\": dataAttr(disabled),\n      })\n    },\n\n    getItemPreviewImageProps(props) {\n      const { file, url } = props\n      const isImage = file.type.startsWith(\"image/\")\n      if (!isImage) {\n        throw new Error(\"Preview Image is only supported for image files\")\n      }\n      return normalize.img({\n        ...parts.itemPreviewImage.attrs,\n        alt: translations.itemPreview(file),\n        src: url,\n        \"data-disabled\": dataAttr(disabled),\n      })\n    },\n\n    getItemDeleteTriggerProps(props) {\n      const { file } = props\n      return normalize.button({\n        ...parts.itemDeleteTrigger.attrs,\n        dir: state.context.dir,\n        type: \"button\",\n        disabled,\n        \"data-disabled\": dataAttr(disabled),\n        \"aria-label\": translations.deleteFile(file),\n        onClick() {\n          if (disabled) return\n          send({ type: \"FILE.DELETE\", file })\n        },\n      })\n    },\n\n    labelProps: normalize.label({\n      ...parts.label.attrs,\n      dir: state.context.dir,\n      id: dom.getLabelId(state.context),\n      htmlFor: dom.getHiddenInputId(state.context),\n      \"data-disabled\": dataAttr(disabled),\n    }),\n  }\n}\n","import { createScope } from \"@zag-js/dom-query\"\nimport type { MachineContext as Ctx } from \"./file-upload.types\"\n\nexport const dom = createScope({\n  getRootId: (ctx: Ctx) => ctx.ids?.root ?? `file:${ctx.id}`,\n  getDropzoneId: (ctx: Ctx) => ctx.ids?.dropzone ?? `file:${ctx.id}:dropzone`,\n  getHiddenInputId: (ctx: Ctx) => ctx.ids?.hiddenInput ?? `file:${ctx.id}:input`,\n  getTriggerId: (ctx: Ctx) => ctx.ids?.trigger ?? `file:${ctx.id}:trigger`,\n  getLabelId: (ctx: Ctx) => ctx.ids?.label ?? `file:${ctx.id}:label`,\n  getItemId: (ctx: Ctx, id: string) => ctx.ids?.item?.(id) ?? `file:${ctx.id}:item:${id}`,\n  getItemNameId: (ctx: Ctx, id: string) => ctx.ids?.itemName?.(id) ?? `file:${ctx.id}:item-name:${id}`,\n  getItemSizeTextId: (ctx: Ctx, id: string) => ctx.ids?.itemSizeText?.(id) ?? `file:${ctx.id}:item-size:${id}`,\n  getItemPreviewId: (ctx: Ctx, id: string) => ctx.ids?.itemPreview?.(id) ?? `file:${ctx.id}:item-preview:${id}`,\n\n  getHiddenInputEl: (ctx: Ctx) => dom.getById<HTMLInputElement>(ctx, dom.getHiddenInputId(ctx)),\n  getDropzoneEl: (ctx: Ctx) => dom.getById(ctx, dom.getDropzoneId(ctx)),\n})\n","import { isValidFileSize, isValidFileType, type FileError } from \"@zag-js/file-utils\"\nimport { type FileRejection, type MachineContext } from \"./file-upload.types\"\n\nexport function isEventWithFiles(event: Pick<DragEvent, \"dataTransfer\" | \"target\">) {\n  if (!event.dataTransfer) return !!event.target && \"files\" in event.target\n  return event.dataTransfer.types.some((type) => {\n    return type === \"Files\" || type === \"application/x-moz-file\"\n  })\n}\n\nexport function isFilesWithinRange(ctx: MachineContext, incomingCount: number) {\n  if (!ctx.multiple && incomingCount > 1) return false\n  if (!ctx.multiple && incomingCount + ctx.files.length === 2) return true\n  if (incomingCount + ctx.files.length > ctx.maxFiles) return false\n  return true\n}\n\nexport function getFilesFromEvent(ctx: MachineContext, files: File[]) {\n  const acceptedFiles: File[] = []\n  const rejectedFiles: FileRejection[] = []\n\n  files.forEach((file) => {\n    const [accepted, acceptError] = isValidFileType(file, ctx.acceptAttr)\n    const [sizeMatch, sizeError] = isValidFileSize(file, ctx.minFileSize, ctx.maxFileSize)\n\n    const validateErrors = ctx.validate?.(file)\n    const valid = validateErrors ? validateErrors.length === 0 : true\n\n    if (accepted && sizeMatch && valid) {\n      acceptedFiles.push(file)\n    } else {\n      const errors = [acceptError, sizeError]\n      if (!valid) errors.push(...(validateErrors ?? []))\n      rejectedFiles.push({ file, errors: errors.filter(Boolean) as FileError[] })\n    }\n  })\n\n  if (!isFilesWithinRange(ctx, acceptedFiles.length)) {\n    acceptedFiles.forEach((file) => {\n      rejectedFiles.push({ file, errors: [\"TOO_MANY_FILES\"] })\n    })\n    acceptedFiles.splice(0)\n  }\n\n  return {\n    acceptedFiles,\n    rejectedFiles,\n  }\n}\n","import { createMachine, guards, ref } from \"@zag-js/core\"\nimport { raf } from \"@zag-js/dom-query\"\nimport { getAcceptAttrString, isFileEqual } from \"@zag-js/file-utils\"\nimport { compact } from \"@zag-js/utils\"\nimport { dom } from \"./file-upload.dom\"\nimport type { MachineContext, MachineState, FileRejection, UserDefinedContext } from \"./file-upload.types\"\nimport { getFilesFromEvent, isFilesWithinRange } from \"./file-upload.utils\"\n\nconst { not } = guards\n\nexport function machine(userContext: UserDefinedContext) {\n  const ctx = compact(userContext)\n  return createMachine<MachineContext, MachineState>(\n    {\n      id: \"fileupload\",\n      initial: \"idle\",\n      context: {\n        minFileSize: 0,\n        maxFileSize: Infinity,\n        maxFiles: 1,\n        allowDrop: true,\n        ...ctx,\n        files: ref(ctx.files ?? []),\n        rejectedFiles: ref([]),\n        invalid: false,\n        translations: {\n          itemPreview: (file) => `preview of ${file.name}`,\n          deleteFile: (file) => `delete file ${file.name}`,\n          ...ctx.translations,\n        },\n      },\n      computed: {\n        acceptAttr: (ctx) => getAcceptAttrString(ctx.accept),\n        multiple: (ctx) => ctx.maxFiles > 1,\n      },\n      on: {\n        \"FILES.SET\": {\n          actions: [\"setFilesFromEvent\"],\n        },\n        \"FILE.DELETE\": {\n          actions: [\"removeFile\"],\n        },\n        \"FILES.CLEAR\": {\n          actions: [\"clearFiles\"],\n        },\n      },\n      states: {\n        idle: {\n          on: {\n            OPEN: {\n              actions: [\"openFilePicker\"],\n            },\n            \"DROPZONE.CLICK\": {\n              actions: [\"openFilePicker\"],\n            },\n            \"DROPZONE.FOCUS\": \"focused\",\n            \"DROPZONE.DRAG_OVER\": [\n              {\n                guard: not(\"isWithinRange\"),\n                target: \"dragging\",\n                actions: [\"setInvalid\"],\n              },\n              { target: \"dragging\" },\n            ],\n          },\n        },\n        focused: {\n          on: {\n            \"DROPZONE.BLUR\": \"idle\",\n            OPEN: {\n              actions: [\"openFilePicker\"],\n            },\n            \"DROPZONE.CLICK\": {\n              actions: [\"openFilePicker\"],\n            },\n            \"DROPZONE.DRAG_OVER\": [\n              {\n                guard: not(\"isWithinRange\"),\n                target: \"dragging\",\n                actions: [\"setInvalid\"],\n              },\n              { target: \"dragging\" },\n            ],\n          },\n        },\n        dragging: {\n          on: {\n            \"DROPZONE.DROP\": {\n              target: \"idle\",\n              actions: [\"clearInvalid\", \"setFilesFromEvent\"],\n            },\n            \"DROPZONE.DRAG_LEAVE\": {\n              target: \"idle\",\n              actions: [\"clearInvalid\"],\n            },\n          },\n        },\n      },\n    },\n    {\n      guards: {\n        isWithinRange: (ctx, evt) => isFilesWithinRange(ctx, evt.count),\n      },\n      actions: {\n        openFilePicker(ctx) {\n          raf(() => {\n            dom.getHiddenInputEl(ctx)?.click()\n          })\n        },\n        setInvalid(ctx) {\n          ctx.invalid = true\n        },\n        clearInvalid(ctx) {\n          ctx.invalid = false\n        },\n        setFilesFromEvent(ctx, evt) {\n          const result = getFilesFromEvent(ctx, evt.files)\n          const { acceptedFiles, rejectedFiles } = result\n\n          if (ctx.multiple) {\n            const files = ref([...ctx.files, ...acceptedFiles])\n            set.files(ctx, files, rejectedFiles)\n            return\n          }\n\n          if (acceptedFiles.length) {\n            const files = ref([acceptedFiles[0]])\n            set.files(ctx, files, rejectedFiles)\n          }\n        },\n        removeFile(ctx, evt) {\n          const nextFiles = ctx.files.filter((file) => file !== evt.file)\n          set.files(ctx, nextFiles)\n        },\n        clearFiles(ctx) {\n          set.files(ctx, [])\n        },\n      },\n      compareFns: {\n        files: (a, b) => a.length === b.length && a.every((file, i) => isFileEqual(file, b[i])),\n      },\n    },\n  )\n}\n\nconst invoke = {\n  change: (ctx: MachineContext) => {\n    ctx.onFilesChange?.({\n      acceptedFiles: ctx.files,\n      rejectedFiles: ctx.rejectedFiles,\n    })\n  },\n  accept: (ctx: MachineContext) => {\n    ctx.onFileAccept?.({ files: ctx.files })\n  },\n  reject: (ctx: MachineContext) => {\n    ctx.onFileReject?.({ files: ctx.rejectedFiles })\n  },\n}\n\nconst set = {\n  files: (ctx: MachineContext, acceptedFiles: File[], rejectedFiles?: FileRejection[]) => {\n    ctx.files = ref(acceptedFiles)\n    invoke.accept(ctx)\n\n    if (rejectedFiles) {\n      ctx.rejectedFiles = ref(rejectedFiles)\n      invoke.reject(ctx)\n    }\n\n    invoke.change(ctx)\n  },\n}\n"],"mappings":"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","names":["ctx"]}