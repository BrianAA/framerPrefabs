{"version":3,"sources":["../src/index.ts","../src/dialog.anatomy.ts","../src/dialog.dom.ts","../src/dialog.connect.ts","../src/dialog.machine.ts"],"sourcesContent":["export { anatomy } from \"./dialog.anatomy\"\nexport { connect } from \"./dialog.connect\"\nexport { machine } from \"./dialog.machine\"\nexport type { MachineApi as Api, UserDefinedContext as Context, OpenChangeDetails, ElementIds } from \"./dialog.types\"\n","import { createAnatomy } from \"@zag-js/anatomy\"\n\nexport const anatomy = createAnatomy(\"dialog\").parts(\n  \"trigger\",\n  \"backdrop\",\n  \"positioner\",\n  \"content\",\n  \"title\",\n  \"description\",\n  \"closeTrigger\",\n)\n\nexport const parts = anatomy.build()\n","import { createScope } from \"@zag-js/dom-query\"\nimport type { MachineContext as Ctx } from \"./dialog.types\"\n\nexport const dom = createScope({\n  getPositionerId: (ctx: Ctx) => ctx.ids?.positioner ?? `dialog:${ctx.id}:positioner`,\n  getBackdropId: (ctx: Ctx) => ctx.ids?.backdrop ?? `dialog:${ctx.id}:backdrop`,\n  getContentId: (ctx: Ctx) => ctx.ids?.content ?? `dialog:${ctx.id}:content`,\n  getTriggerId: (ctx: Ctx) => ctx.ids?.trigger ?? `dialog:${ctx.id}:trigger`,\n  getTitleId: (ctx: Ctx) => ctx.ids?.title ?? `dialog:${ctx.id}:title`,\n  getDescriptionId: (ctx: Ctx) => ctx.ids?.description ?? `dialog:${ctx.id}:description`,\n  getCloseTriggerId: (ctx: Ctx) => ctx.ids?.closeTrigger ?? `dialog:${ctx.id}:close`,\n\n  getContentEl: (ctx: Ctx) => dom.getById(ctx, dom.getContentId(ctx)),\n  getTriggerEl: (ctx: Ctx) => dom.getById(ctx, dom.getTriggerId(ctx)),\n  getTitleEl: (ctx: Ctx) => dom.getById(ctx, dom.getTitleId(ctx)),\n  getDescriptionEl: (ctx: Ctx) => dom.getById(ctx, dom.getDescriptionId(ctx)),\n})\n","import type { NormalizeProps, PropTypes } from \"@zag-js/types\"\nimport { parts } from \"./dialog.anatomy\"\nimport { dom } from \"./dialog.dom\"\nimport type { MachineApi, Send, State } from \"./dialog.types\"\n\nexport function connect<T extends PropTypes>(state: State, send: Send, normalize: NormalizeProps<T>): MachineApi<T> {\n  const ariaLabel = state.context[\"aria-label\"]\n  const isOpen = state.matches(\"open\")\n  const rendered = state.context.renderedElements\n\n  return {\n    isOpen,\n    open() {\n      send(\"OPEN\")\n    },\n    close() {\n      send(\"CLOSE\")\n    },\n\n    triggerProps: normalize.button({\n      ...parts.trigger.attrs,\n      dir: state.context.dir,\n      id: dom.getTriggerId(state.context),\n      \"aria-haspopup\": \"dialog\",\n      type: \"button\",\n      \"aria-expanded\": isOpen,\n      \"data-state\": isOpen ? \"open\" : \"closed\",\n      \"aria-controls\": dom.getContentId(state.context),\n      onClick() {\n        send(\"TOGGLE\")\n      },\n    }),\n\n    backdropProps: normalize.element({\n      ...parts.backdrop.attrs,\n      dir: state.context.dir,\n      hidden: !isOpen,\n      id: dom.getBackdropId(state.context),\n      \"data-state\": isOpen ? \"open\" : \"closed\",\n    }),\n\n    positionerProps: normalize.element({\n      ...parts.positioner.attrs,\n      dir: state.context.dir,\n      id: dom.getPositionerId(state.context),\n      style: {\n        pointerEvents: isOpen ? undefined : \"none\",\n      },\n    }),\n\n    contentProps: normalize.element({\n      ...parts.content.attrs,\n      dir: state.context.dir,\n      role: state.context.role,\n      hidden: !isOpen,\n      id: dom.getContentId(state.context),\n      tabIndex: -1,\n      \"data-state\": isOpen ? \"open\" : \"closed\",\n      \"aria-modal\": true,\n      \"aria-label\": ariaLabel || undefined,\n      \"aria-labelledby\": ariaLabel || !rendered.title ? undefined : dom.getTitleId(state.context),\n      \"aria-describedby\": rendered.description ? dom.getDescriptionId(state.context) : undefined,\n    }),\n\n    titleProps: normalize.element({\n      ...parts.title.attrs,\n      dir: state.context.dir,\n      id: dom.getTitleId(state.context),\n    }),\n\n    descriptionProps: normalize.element({\n      ...parts.description.attrs,\n      dir: state.context.dir,\n      id: dom.getDescriptionId(state.context),\n    }),\n\n    closeTriggerProps: normalize.button({\n      ...parts.closeTrigger.attrs,\n      dir: state.context.dir,\n      id: dom.getCloseTriggerId(state.context),\n      type: \"button\",\n      onClick(event) {\n        event.stopPropagation()\n        send(\"CLOSE\")\n      },\n    }),\n  }\n}\n","import { ariaHidden } from \"@zag-js/aria-hidden\"\nimport { createMachine } from \"@zag-js/core\"\nimport { trackDismissableElement } from \"@zag-js/dismissable\"\nimport { nextTick, raf } from \"@zag-js/dom-query\"\nimport { preventBodyScroll } from \"@zag-js/remove-scroll\"\nimport { compact, runIfFn } from \"@zag-js/utils\"\nimport { createFocusTrap, type FocusTrap } from \"focus-trap\"\nimport { dom } from \"./dialog.dom\"\nimport type { MachineContext, MachineState, UserDefinedContext } from \"./dialog.types\"\n\nexport function machine(userContext: UserDefinedContext) {\n  const ctx = compact(userContext)\n  return createMachine<MachineContext, MachineState>(\n    {\n      id: \"dialog\",\n      initial: ctx.open ? \"open\" : \"closed\",\n\n      context: {\n        role: \"dialog\",\n        renderedElements: {\n          title: true,\n          description: true,\n        },\n        modal: true,\n        trapFocus: true,\n        preventScroll: true,\n        closeOnInteractOutside: true,\n        closeOnEscapeKeyDown: true,\n        restoreFocus: true,\n        ...ctx,\n      },\n\n      watch: {\n        open: [\"toggleVisibility\"],\n      },\n\n      states: {\n        open: {\n          entry: [\"checkRenderedElements\"],\n          activities: [\"trackDismissableElement\", \"trapFocus\", \"preventScroll\", \"hideContentBelow\"],\n          on: {\n            CLOSE: {\n              target: \"closed\",\n              actions: [\"invokeOnClose\", \"restoreFocus\"],\n            },\n            TOGGLE: {\n              target: \"closed\",\n              actions: [\"invokeOnClose\", \"restoreFocus\"],\n            },\n          },\n        },\n        closed: {\n          on: {\n            OPEN: {\n              target: \"open\",\n              actions: [\"invokeOnOpen\"],\n            },\n            TOGGLE: {\n              target: \"open\",\n              actions: [\"invokeOnOpen\"],\n            },\n          },\n        },\n      },\n    },\n    {\n      activities: {\n        trackDismissableElement(ctx, _evt, { send }) {\n          const getContentEl = () => dom.getContentEl(ctx)\n          return trackDismissableElement(getContentEl, {\n            defer: true,\n            pointerBlocking: ctx.modal,\n            exclude: [dom.getTriggerEl(ctx)],\n            onEscapeKeyDown(event) {\n              if (!ctx.closeOnEscapeKeyDown) event.preventDefault()\n              else send({ type: \"CLOSE\", src: \"escape-key\" })\n              ctx.onEscapeKeyDown?.(event)\n            },\n            onPointerDownOutside(event) {\n              if (!ctx.closeOnInteractOutside) event.preventDefault()\n              ctx.onPointerDownOutside?.(event)\n            },\n            onFocusOutside(event) {\n              if (!ctx.closeOnInteractOutside) event.preventDefault()\n              ctx.onFocusOutside?.(event)\n            },\n            onDismiss() {\n              send({ type: \"CLOSE\", src: \"interact-outside\" })\n            },\n          })\n        },\n        preventScroll(ctx) {\n          if (!ctx.preventScroll) return\n          return preventBodyScroll(dom.getDoc(ctx))\n        },\n        trapFocus(ctx) {\n          if (!ctx.trapFocus || !ctx.modal) return\n          let trap: FocusTrap\n          nextTick(() => {\n            const contentEl = dom.getContentEl(ctx)\n            if (!contentEl) return\n            trap = createFocusTrap(contentEl, {\n              document: dom.getDoc(ctx),\n              escapeDeactivates: false,\n              preventScroll: true,\n              returnFocusOnDeactivate: false,\n              fallbackFocus: contentEl,\n              allowOutsideClick: true,\n              initialFocus: runIfFn(ctx.initialFocusEl),\n            })\n            try {\n              trap.activate()\n            } catch {}\n          })\n          return () => trap?.deactivate()\n        },\n        hideContentBelow(ctx) {\n          if (!ctx.modal) return\n          const getElements = () => [dom.getContentEl(ctx)]\n          return ariaHidden(getElements, { defer: true })\n        },\n      },\n      actions: {\n        checkRenderedElements(ctx) {\n          raf(() => {\n            ctx.renderedElements.title = !!dom.getTitleEl(ctx)\n            ctx.renderedElements.description = !!dom.getDescriptionEl(ctx)\n          })\n        },\n        invokeOnClose(ctx) {\n          ctx.onOpenChange?.({ open: false })\n        },\n        invokeOnOpen(ctx) {\n          ctx.onOpenChange?.({ open: true })\n        },\n        toggleVisibility(ctx, _evt, { send }) {\n          send({ type: ctx.open ? \"OPEN\" : \"CLOSE\", src: \"controlled\" })\n        },\n        restoreFocus(ctx) {\n          if (!ctx.restoreFocus) return\n          raf(() => {\n            const el = runIfFn(ctx.finalFocusEl) ?? dom.getTriggerEl(ctx)\n            el?.focus({ preventScroll: true })\n          })\n        },\n      },\n    },\n  )\n}\n"],"mappings":"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","names":["import_dom_query","ctx"]}