{"version":3,"sources":["../src/add-dom-event.ts","../src/assertion.ts","../src/fire-event.ts","../src/get-event-key.ts","../src/get-event-point.ts","../src/get-event-step.ts","../src/get-native-event.ts","../src/get-point-value.ts","../src/request-pointer-lock.ts","../src/track-pointer-move.ts","../src/track-visual-viewport.ts"],"sourcesContent":["interface EventMap extends DocumentEventMap, WindowEventMap, HTMLElementEventMap {}\n\ntype Node = Document | HTMLElement | EventTarget | null\n\ntype Target = (() => Node) | Node\n\nexport const addDomEvent = <K extends keyof EventMap>(\n  target: Target,\n  eventName: K,\n  handler: (event: EventMap[K]) => void,\n  options?: boolean | AddEventListenerOptions,\n) => {\n  const node = typeof target === \"function\" ? target() : target\n  node?.addEventListener(eventName, handler as any, options)\n  return () => {\n    node?.removeEventListener(eventName, handler as any, options)\n  }\n}\n","export function isKeyboardClick(e: Pick<MouseEvent, \"detail\" | \"clientX\" | \"clientY\">) {\n  return e.detail === 0 || (e.clientX === 0 && e.clientY === 0)\n}\n\nexport function isPrintableKey(e: Pick<KeyboardEvent, \"key\" | \"ctrlKey\" | \"metaKey\">): boolean {\n  return e.key.length === 1 && !e.ctrlKey && !e.metaKey\n}\n\nexport function isVirtualPointerEvent(e: PointerEvent) {\n  return (\n    (e.width === 0 && e.height === 0) ||\n    (e.width === 1 && e.height === 1 && e.pressure === 0 && e.detail === 0 && e.pointerType === \"mouse\")\n  )\n}\n\nexport function isVirtualClick(e: MouseEvent | PointerEvent): boolean {\n  if ((e as any).mozInputSource === 0 && e.isTrusted) return true\n  return e.detail === 0 && !(e as PointerEvent).pointerType\n}\n\nexport const isLeftClick = (e: Pick<MouseEvent, \"button\">) => e.button === 0\n\nexport const isContextMenuEvent = (e: Pick<MouseEvent, \"button\" | \"ctrlKey\" | \"metaKey\">) => {\n  return e.button === 2 || (isMac() && e.ctrlKey && e.button === 0)\n}\n\nexport const isModifiedEvent = (e: Pick<KeyboardEvent, \"ctrlKey\" | \"metaKey\" | \"altKey\">) =>\n  e.ctrlKey || e.altKey || e.metaKey\n\nconst isMac = () => /Mac|iPod|iPhone|iPad/.test(window.navigator.platform)\n","export function fireCustomEvent(el: HTMLElement | null, type: string, init?: CustomEventInit) {\n  if (!el) return\n  const win = el.ownerDocument.defaultView || window\n  const event = new win.CustomEvent(type, init)\n  return el.dispatchEvent(event)\n}\n\nexport function fireBlurEvent(el: HTMLElement, init?: FocusEventInit) {\n  const win = el.ownerDocument.defaultView || window\n  const event = new win.FocusEvent(\"blur\", init)\n  const allowed = el.dispatchEvent(event)\n  const bubbleInit = { ...init, bubbles: true }\n  el.dispatchEvent(new win.FocusEvent(\"focusout\", bubbleInit))\n  return allowed\n}\n","import type { EventKeyOptions } from \"./types\"\n\nconst keyMap = {\n  Up: \"ArrowUp\",\n  Down: \"ArrowDown\",\n  Esc: \"Escape\",\n  \" \": \"Space\",\n  \",\": \"Comma\",\n  Left: \"ArrowLeft\",\n  Right: \"ArrowRight\",\n}\n\nconst rtlKeyMap = {\n  ArrowLeft: \"ArrowRight\",\n  ArrowRight: \"ArrowLeft\",\n}\n\n/**\n * Determine the event key based on text direction.\n */\nexport function getEventKey(event: Pick<KeyboardEvent, \"key\">, options: EventKeyOptions = {}) {\n  const { dir = \"ltr\", orientation = \"horizontal\" } = options\n\n  let { key } = event\n  key = keyMap[key] ?? key // normalize key\n\n  const isRtl = dir === \"rtl\" && orientation === \"horizontal\"\n\n  if (isRtl && key in rtlKeyMap) {\n    key = rtlKeyMap[key]\n  }\n\n  return key\n}\n","type PointType = \"page\" | \"client\"\n\nfunction pointFromTouch(e: TouchEvent, type: PointType = \"client\") {\n  const point = e.touches[0] || e.changedTouches[0]\n  return { x: point[`${type}X`], y: point[`${type}Y`] }\n}\n\nfunction pointFromMouse(point: MouseEvent | PointerEvent, type: PointType = \"client\") {\n  return { x: point[`${type}X`], y: point[`${type}Y`] }\n}\n\ntype AnyPointerEvent = MouseEvent | TouchEvent | PointerEvent\n\nconst isTouchEvent = (event: AnyPointerEvent): event is TouchEvent => \"touches\" in event && event.touches.length > 0\n\nexport function getEventPoint(event: AnyPointerEvent, type: PointType = \"client\") {\n  return isTouchEvent(event) ? pointFromTouch(event, type) : pointFromMouse(event, type)\n}\n","const PAGE_KEYS = new Set([\"PageUp\", \"PageDown\"])\nconst ARROW_KEYS = new Set([\"ArrowUp\", \"ArrowDown\", \"ArrowLeft\", \"ArrowRight\"])\n\n/**\n * Determine the step factor for keyboard events\n */\nexport function getEventStep(event: Pick<KeyboardEvent, \"ctrlKey\" | \"metaKey\" | \"key\" | \"shiftKey\">) {\n  if (event.ctrlKey || event.metaKey) {\n    return 0.1\n  } else {\n    const isPageKey = PAGE_KEYS.has(event.key)\n    const isSkipKey = isPageKey || (event.shiftKey && ARROW_KEYS.has(event.key))\n    return isSkipKey ? 10 : 1\n  }\n}\n","import type { JSX } from \"@zag-js/types\"\n\ntype NativeEvent<E> = JSX.ChangeEvent<any> extends E\n  ? InputEvent\n  : E extends JSX.SyntheticEvent<any, infer T>\n    ? T\n    : never\n\nexport function getNativeEvent<E>(event: E): NativeEvent<E> {\n  return (event as any).nativeEvent ?? event\n}\n","function clamp(value: number) {\n  return Math.max(0, Math.min(1, value))\n}\n\nexport type Point = {\n  x: number\n  y: number\n}\n\ntype PercentValueOptions = {\n  inverted?: boolean | { x?: boolean; y?: boolean }\n  dir?: \"ltr\" | \"rtl\"\n  orientation?: \"vertical\" | \"horizontal\"\n}\n\nexport function getRelativePoint(point: Point, element: HTMLElement) {\n  const { left, top, width, height } = element.getBoundingClientRect()\n\n  const offset = { x: point.x - left, y: point.y - top }\n  const percent = { x: clamp(offset.x / width), y: clamp(offset.y / height) }\n\n  function getPercentValue(options: PercentValueOptions = {}) {\n    const { dir = \"ltr\", orientation = \"horizontal\", inverted } = options\n\n    const invertX = typeof inverted === \"object\" ? inverted.x : inverted\n    const invertY = typeof inverted === \"object\" ? inverted.y : inverted\n\n    if (orientation === \"horizontal\") {\n      return dir === \"rtl\" || invertX ? 1 - percent.x : percent.x\n    }\n\n    return invertY ? 1 - percent.y : percent.y\n  }\n\n  return { offset, percent, getPercentValue }\n}\n","import { addDomEvent } from \"./add-dom-event\"\n\nexport function requestPointerLock(doc: Document, fn?: (locked: boolean) => void) {\n  const body = doc.body\n\n  const supported = \"pointerLockElement\" in doc || \"mozPointerLockElement\" in doc\n  const isLocked = () => !!doc.pointerLockElement\n\n  function onPointerChange() {\n    fn?.(isLocked())\n  }\n\n  function onPointerError(event: Event) {\n    if (isLocked()) fn?.(false)\n    console.error(\"PointerLock error occured:\", event)\n    doc.exitPointerLock()\n  }\n\n  if (!supported) return\n\n  try {\n    body.requestPointerLock()\n  } catch {}\n\n  // prettier-ignore\n  const cleanup = [\n    addDomEvent(doc, \"pointerlockchange\", onPointerChange, false),\n    addDomEvent(doc, \"pointerlockerror\", onPointerError, false)\n  ]\n\n  return () => {\n    cleanup.forEach((cleanup) => cleanup())\n    doc.exitPointerLock()\n  }\n}\n","import { disableTextSelection } from \"@zag-js/text-selection\"\nimport { addDomEvent } from \"./add-dom-event\"\nimport { getEventPoint } from \"./get-event-point\"\n\ntype Point = {\n  x: number\n  y: number\n}\n\ntype PointerMoveHandlers = {\n  onPointerUp: VoidFunction\n  onPointerMove: (details: { point: Point; event: PointerEvent }) => void\n}\n\nexport function trackPointerMove(doc: Document, handlers: PointerMoveHandlers) {\n  const { onPointerMove, onPointerUp } = handlers\n\n  const handleMove = (event: PointerEvent) => {\n    const point = getEventPoint(event)\n\n    const distance = Math.sqrt(point.x ** 2 + point.y ** 2)\n    const moveBuffer = event.pointerType === \"touch\" ? 10 : 5\n\n    if (distance < moveBuffer) return\n\n    // Because Safari doesn't trigger mouseup events when it's above a `<select>`\n    if (event.pointerType === \"mouse\" && event.button === 0) {\n      onPointerUp()\n      return\n    }\n\n    onPointerMove({ point, event })\n  }\n\n  const cleanups = [\n    addDomEvent(doc, \"pointermove\", handleMove, false),\n    addDomEvent(doc, \"pointerup\", onPointerUp, false),\n    addDomEvent(doc, \"pointercancel\", onPointerUp, false),\n    addDomEvent(doc, \"contextmenu\", onPointerUp, false),\n    disableTextSelection({ doc }),\n  ]\n\n  return () => {\n    cleanups.forEach((cleanup) => cleanup())\n  }\n}\n","import { addDomEvent } from \"./add-dom-event\"\n\ntype ViewportSize = {\n  width: number\n  height: number\n}\n\nexport function trackVisualViewport(doc: Document, fn: (data: ViewportSize) => void) {\n  const win = doc?.defaultView || window\n\n  const onResize = () => {\n    fn?.(getViewportSize(win))\n  }\n\n  onResize()\n\n  return addDomEvent(win.visualViewport ?? win, \"resize\", onResize)\n}\n\nfunction getViewportSize(win: Window): ViewportSize {\n  return {\n    width: win.visualViewport?.width || win.innerWidth,\n    height: win.visualViewport?.height || win.innerHeight,\n  }\n}\n"],"mappings":"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","names":["cleanup"]}